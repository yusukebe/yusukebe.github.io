{
    "data" :  {
    "title": "4travel.jpとGoogleマップのマッシュアップサイトを作ってみた",
    "date": "2007-01-15 16:58:00 +0900 JST",
    "dir": "posts/2007/",
    "slug": "0115075835",
    "categories": ["tech"],
    "tags": ["Perl"]
}

---



<p>
  <a href="http://apiblog.kakaku.com/2006/11/com_webmozilla_japan_1.html">価格.com WEBサービスコンテスト</a>なるものが開催されていて、締め切りが今日。参加賞の「Mozilla Firefox ノベルティ」欲しい！ということで、勉強も兼ねて、<a href="http://4travel.jp/">旅行のクチコミサイトサイト4travel.jp</a>とGoogleマップのマッシュアップサイトを作ってみた→<a href="http://pulpsite.net/4trawalker/">4traWalker</a>
</p>
<p>
  <a href="http://pulpsite.net/4trawalker/">
    <img alt="4traWalker" class="at-xid-6a0133f4781589970b015435b6eb10970c" src="https://yusukebe.com/archives/a/6a0133f4781589970b015435b6eb10970c-pi.jpg">
  </a>
</p>
<p>
  【説明】4traWalkerは4travel.jpの旅行アルバムをGoogleマップからたどることができるサイトです。
  マップ上の適当な場所をクリックするとその場所にちなんだ4travel.jpのアルバム写真が表示され、詳細も見ることができます。
</p>
<p>
  ノリで作ったので、うまく動かない点結構あると思いますが、ご了承を。
</p>
<p>
  簡単な作り方の解説。
  実装方針としては基本Javascript/Ajaxでできる部分はブラウザ側に任せて、API叩いてJSONを吐くプロキシとしてCatalystを使うという感じ。もう<a href="http://search.cpan.org/~miyagawa/Catalyst-View-JSON-0.11/">View::JSON</a>使いまくり。
  動作の流れは、Googleマップでクリックされらそこの緯度・経度を取得→それをキーとして<a href="http://www.knya.net/archives/2005/07/rest.html">invGeocoder</a>を使って住所を割り出す→4travelのエリアキーとマッピングさせる(マスタ参照csvから検索)→<a href="http://apiblog.kakaku.com/4travelSearchAlbumV1.0.html">4travelのJSONPのAPI</a>にエリアキーを投げる→ブラウザ側Javascriptのコールバック関数で処理して画像を並べる→画像がクリックされたら<a href="http://prototype-window.xilinus.com/">Prototype Window Class</a>で詳細を表示させる、という具合。あと地味にAmazon ECSで検索かけてその地域に関係するかもしれない書籍も表示させたりもしてる。
  クリックされたエリアと4travel.jpのエリアキーの対応が結構曖昧なので、クリックしても「県」の情報しか出てこなかったり、クリックした場所と違う場所にある同じ地名の写真でてるぞ、という場合もある実装。
  このサイトも含め最近Javascriptのコーディングしていて、昔FlashのActionscriptをガリガリと書いていたときを思い出す。
  もっと綺麗なコード書かなきゃなとか、Javascriptでもロジックとビューの部分をわけた方がいいなと体感できてよかった。
</p>


 
}
