{
    "data" :  {
    "title": "PlaggerとCatalystでエロサイト作ってみた",
    "date": "2006-10-21 20:16:00 +0900 JST",
    "dir": "posts/2006/",
    "slug": "1021111644",
    "categories": ["tech"],
    "tags": ["Perl"]
}

---



<p>
  Perlで書かれたプラガブルなRSS/ATOMフィードアグリゲーター(直訳)<strong>Plagger</strong>とPerlのウェブアプリケーションフレームワーク<strong>Catalyst</strong>を使ってエロサイトを作ってみた。とりあえず公開。以前作った<a href="http://yusukebe.com/archives/06/08/24/194057.html">ERO Pla</a>の進化版にあたります。動画系優良アダルトサイトの更新情報を自動取得して表示閲覧可能なだけではなく、エロページを検索をすることややタグ・キーワードをたどってエロページをみることができます。一応なんちゃってWeb2.0風なエロサイトを目指しています。
  で、Catalystを使ったということでその名も<strong>Erolyst/エロリスト</strong>！
  場所はこちら：<a href="http://pulpsite.net/erolyst/">エロリスト</a>（18歳未満立ち入り禁止！）。まじCatalystの勉強になった。というか勉強のためと割り切ったらエロサイトみても興奮しなくなったｗ
</p>
<p>
  <img alt="エロリスト" class="at-xid-6a0133f4781589970b015435b6ea24970c" src="https://yusukebe.com/archives/a/6a0133f4781589970b015435b6ea24970c-pi.jpg">
</p>
<p>
  以下ざくっとした仕組みについてだらだらと。
</p>
<p>
  まず、ERO PlaでもやっているようにFilter-EntryFullTextを使って動画系アダルトサイトの新着ページをアグリゲートしてくる。それでそのデータをStore-DBICを使ってsqliteのファイル形式にしてそれをCatalystで読み込むというのが基本構成。
  これやるとCatalystからPlaggerのフィードオブジェクトをモデルとして操作できるのでいろいろできるわけだ。
  特に、これを使ってアサマシイことも考えているので、たとえばエントリー毎をPermalink化させて自分のサイトに取り込むことができるのが魅力。
  Catalystのコード、一部公開するとEntryというパーマリンクを生成するメソッドはこうなっている。
</p>
<pre class="code">sub Entry : LocalRegex('^(http://.*)') {
  my ( $self, $c ) = @_;
  my $url = $c-&gt;request-&gt;uri;
  my $uri_for = $c-&gt;uri_for;
  $url =~ s|$uri_for||;
  
  my @entries = Erolyst::Model::Plagger::Entry-&gt;search(permalink=&gt;$url);
  my @tags = Erolyst::Model::Plagger::EntryTag-&gt;search(entry=&gt;$entries[0]-&gt;id);
  $c-&gt;log-&gt;info($entries[0]-&gt;tags);
  $c-&gt;stash-&gt;{entry} = $entries[0];
  $c-&gt;stash-&gt;{tags} = $entries[0]-&gt;tags;
  $c-&gt;stash-&gt;{template} = 'entry.tt';
}</pre>
<p>
  Catalystはいい点のひとつとしてこれを使うとURIがきれいになるというのがあるけど、
  それをかなり体感できた。SEOの効果があがると嬉しい。
</p>
<p>
  次に大きな機能として、検索というのがあるが、これはPlaggerのSearch-Namazuを使ってインデックスを作ってCatalystのコントロール側ではCPANモジュールSearch::Namazuで操作をしているという具合。
</p>
<p>
  もう一つの面白い機能はタグ機能。
  普通タグ付けというとソーシャルブックマークのようにユーザー自身がつけるのだけど、
  このエロリストではちょっとそうしたCGM（Customer Generated Media）的要素ではない。
  どうやってつけられるかというと、PlaggerでFilter-EntryFullTextで抽出するときに、適当に女優名などを見つけてきてそれをタグとしてくっつけている（参照: <a href="http://yusukebe.com/archives/06/08/30/204124.html">ゆーすけべー日記: EntryFullTextをタグ入れれるように修正</a>）。というわけで例えば、<a href="http://pulpsite.net/erolyst/tag/%E7%99%BD%E7%9F%B3%E3%81%B2%E3%82%88%E3%82%8A">白石ひよりタグページ</a>とかできるわけ。
</p>
<p>
  CGMの件に触れたけど、一応Plaggerのモデル以外にも独自のモデルを作って、例えば、人気のあるタグがわかったりよく検索されるキーワードがわかるようになっている。
  <a href="http://pulpsite.net/erolyst/tag/">タグのページ</a>でははてな風味にクリック数の多いタグがでかくなるという仕組みです。
</p>
<p>
  というわけで解説終わり。このPlagger＋Store-DBIC＋Catalystという構成はなかなか面白いということがわかった次第です。さて、このエロリストどうなっていくのやら。あ、あくまでアダルトコンテンツを含んでいるので18禁ですよー（エロリスト本サイトで18歳未満の人の退席先はYahoo!じゃくてはてなにしておいたｗ）。
</p>
<h5>追記</h5>
<p>
  なんか検索がうまくいかないときがある。Search::Namazuがいけないのかなぁ。いやmod_perlで動かすとおかしいぞ</p>


 
}
